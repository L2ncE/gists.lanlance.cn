## 计算机图形学

>掌握计算机图形学的基本概念，理解光栅图形生成基本算法。理解三个常用直线生成算法，理解和掌握多边形的扫描转换、区域填充算法。掌握曲线的概念，曲线曲面的表示。掌握 Bezier 曲线、B 样条曲线、非均匀有理 B 样条曲线的定义和性质、算法。理解颜色的基本概念、三色学说、CIE 色度图、掌握常用的颜色模型，掌握光照相关知识，掌握几种基础光照模型，理解光线跟踪算法。熟悉 OpenGL 程序结构、基本几何元素、坐标变换和光照处理。

### 图形学概论

#### 图像 vs 图形

| 图像                    | 图形                       |
| ----------------------- | -------------------------- |
| 简单，相机，真实的      | 复杂，由算法生成，是合成的 |
| 表示：用像素阵列表示    | 表示：几何属性 + 物理属性  |
| 像素有颜色值 (或灰度值) | 需要人来设计和构造         |

#### 生成的图形

| 线框图     | 真实感图形 | 非真实感图形     |
| ---------- | ---------- | ---------------- |
| 用线条表示 | 侧重真实感 | 侧重艺术、风格化 |

#### 帧缓存

作用：存储将要显示的图形信息和保存中间数据。

包括：颜色缓存和深度缓存等。

显存与 GPU 的关系，就像内存和 CPU 的关系一样。

#### 图形学之父

I.E. Sutherland

### 二维集合变换

#### 概念

坐标系不动，把一个图形通过平移、旋转、缩放、对称、错切变换变成新的图形。

1. 对简单图形作变换和组合，可以构成复杂图形，是造型的方法之一。
2. 三维变换的基础。

#### 基本变换

##### 平移变换

![](https://picture.lanlance.cn/i/2023/12/25/65896f7c4d64e.png)

性质：只改变位置，不改变形状和大小。

##### 旋转变换

![](https://picture.lanlance.cn/i/2023/12/25/6589711ddb7ae.png)

性质：不改变大小、距离和角度，会改变朝向

##### 缩放变换

![](https://picture.lanlance.cn/i/2023/12/25/658983ce0cc11.png)

当 Sx == Sy 时为均匀缩放，反之为非均匀缩放。

性质：

![](https://picture.lanlance.cn/i/2023/12/25/658983e5d51b5.png)

##### 对称变换

关于 x 轴，y 轴，原点的对称变换是特殊的缩放变换。

![](https://picture.lanlance.cn/i/2023/12/25/658983f9b3b20.png)

##### 逆变换

正变换：从 P(x,y) 变到 P’(x’ ,y’)

逆变换：从 P’(x’ ,y’) 变回 P(x,y)

##### 复合变换

- 复合平移
- 复合旋转
- 先平移，再旋转，再缩放
- 先旋转，再平移，再缩放
- ...

性质：复合变换不满足可交换性

![](https://picture.lanlance.cn/i/2023/12/25/6589841611356.png)

#### 关于参考点旋转

![](https://picture.lanlance.cn/i/2023/12/25/6589841eebbe2.png)

相对某个参考点 (xr,yr) 的旋转变换：

(1) 作平移

(2) 作相对原点的旋转

(3) 作反平移

![](https://picture.lanlance.cn/i/2023/12/25/658984272c36f.png)

#### 矩阵乘向量

![](https://picture.lanlance.cn/i/2023/12/25/6589843273e98.png)

#### 齐次坐标

把 n 维空间的点表示成 n + 1 维空间的点，称前者为普通坐标，后者为齐次坐标。

##### 齐次坐标不唯一

(1,3,0) 的齐次坐标是 (2,6,0,2)、(1.5,4.5,0,1.5) —— 不唯一。

##### 普通坐标与齐次坐标的关系

![](https://picture.lanlance.cn/i/2023/12/25/6589843fd0a88.png)

##### 规范化齐次坐标

h=1 时的齐次坐标成为规范化齐次坐标。

![](https://picture.lanlance.cn/i/2023/12/25/658984523180b.png)

##### 矩阵乘向量

![](https://picture.lanlance.cn/i/2023/12/25/6589845876d54.png)

### 三维图形变换

坐标系不动，点动。

特点：
1. 比 2D 增加了 z 坐标
2. 比 2D 更复杂、更真实

三维几何变换性质：
- 平移——改变位置
- 旋转——改变方向
- 缩放——改变大小和形状
- 对称
- 错切

#### 平移变换

![](https://picture.lanlance.cn/i/2023/12/25/65898632cded3.png)

只改变位置，不改变大小和形状。

#### 旋转变换

##### 绕三个坐标轴的旋转

绕 z 轴旋转：约定人眼在 z 轴正方向，看向原点，逆时针为正方向

##### 绕三个坐标轴正方向旋转

![](https://picture.lanlance.cn/i/2023/12/25/6589876f90114.png)

##### 绕任意轴的旋转

eg.

![](https://picture.lanlance.cn/i/2023/12/25/658987e3adf0c.png)
#### 投影变换

数学上：从 n 维空间到 k(<n) 维空间的变换。
CG：从 3D 空间到 2D 平面的变换。

物体在 3D 空间，屏幕在 2D 平面，必须作投影变换。投影变换是 3D 图形学的核心。

##### 基本概念

![](https://picture.lanlance.cn/i/2023/12/25/6589897576820.png)

投影中心：相当于人眼或相机，也称视点或观察点
投影线：相当于光线
投影面：相当于成像平面，位于 COP 和物体之间
投影线与投影面相交，在投影面上的像就是物体的投影。

##### 光学成像 vs 虚拟成像

![](https://picture.lanlance.cn/i/2023/12/26/658a700da264a.png)

##### 透视投影 vs 平行投影

![](https://picture.lanlance.cn/i/2023/12/26/658a72005a81d.png)

透视投影：COP 到投影面的距离有限
平行投影：COP 到投影面的距离无限

平行投影是透视投影的极限

##### 平行投影

![](https://picture.lanlance.cn/i/2023/12/26/658a72c460024.png)

类比太阳光

###### 三视图

![](https://picture.lanlance.cn/i/2023/12/26/658a7301aa792.png)

性质：保持距离和角度不变，适用于建筑和施工图纸。

###### 三视图的变换公式

![](https://picture.lanlance.cn/i/2023/12/26/658a73ea168e0.png)

###### 正轴测投影

![](https://picture.lanlance.cn/i/2023/12/26/658a73a401bdc.png)

###### 缺点

物体投影的大小与物体离投影面的距离无关，与人的视觉不符。

##### 透视投影

符合人的视觉特点，远小近大，更真实

性质：平行于投影面的平行线投影后仍然平行。不平行于投影面的平行线投影后汇聚于一点。

###### 透视投影变换公式

![](https://picture.lanlance.cn/i/2023/12/26/658a747725a40.png)

#### 坐标系

##### 建模坐标系

1. 三维坐标系，坐标在 R 上取值
2. 目的：用来定义单个物体，比如球体，长方体，圆柱体。。。
3. 每个物体都可以有自己的建模坐标系。MC 是局部坐标系，如果物体改变，MC 也随之改变。

##### 世界坐标系

1. 三维坐标系，坐标在 R 上取值
2. 目的：定义所有对象，包括物体，观察者的位置和视线、投影平面等。
3. 是全局坐标系，其它坐标系都参照 WC 来定义。

##### 观察坐标系

1. 目的：从观察者的角度描述 WC 中的所有物体。
2. 类比照相：选择拍摄的位置和方向。
3. 对同一场景，在不同视点处的观察结果不同。

##### 投影面坐标系

![](https://picture.lanlance.cn/i/2023/12/26/658a77594ad9b.png)

##### 设备坐标系

1. 设备自带的坐标系。设备不同，设备坐标系也不同。
2. 二维坐标系，取离散值，比如 1024 * 768，1920 * 1080。

##### 规范化设备坐标系

1. 二维坐标系，在 0≤X≤1，0≤Y≤1 取连续值。
2. 目的：为了解决应用程序的可移植性的问题，使图形处理独立于具体的输出设备。
3. 虚拟的设备坐标系。
### 多边形的扫描转换

把顶点表示转换为点阵表示

本质：给定多边形的顶点序列，确定哪些像素在多边形内部。

#### 多边形的表示

| 顶点表示                                               | 点阵表示                                                     |
| ------------------------------------------------------ | ------------------------------------------------------------ |
| 用顶点序列表示。                                       | 用多边形内部的像素表示。                                     |
| 优点：几何意义明显，直观，存储空间少，便于作几何变换。 | 优点：适用于面着色。                                         |
| 缺点：不能直接进行面着色。                             | 缺点：失去顶点、边界等几何信息，存储空间多，不便作几何变换。 |

#### 点的包含性检验

##### 转角法

![](https://picture.lanlance.cn/i/2023/12/26/658aa39e06eb7.png)

缺点：逐点判别，计算夹角的大小和方向
##### 射线法

![](https://picture.lanlance.cn/i/2023/12/26/658aa3c6296e4.png)

看奇偶：如果交点个数是偶数（包括 0），则点在外面；否则在里面。

缺点：逐点判别，需要判断一条射线和所有边是否有交点

#### 扫描线填充算法

1．求所有顶点的 MIN 和 MAX——确定多边形覆盖的扫描线条数
2．从 MIN 到 MAX，每次用一条扫描线进行填充

![](https://picture.lanlance.cn/i/2023/12/26/658aa4f008225.png)

1. 求交：依次计算该扫描线与各边的交点；
2. 排序：把所有交点按 x 值递增排序 (比如冒泡)；
3. 配对：第 1 与第 2，第 3 与第 4，每对交点确定一个小区间；
4. 填色：把小区间内的像素赋予颜色。

##### 如何避免不必要的求交

![](https://picture.lanlance.cn/i/2023/12/26/658aa5e7b3f1c.png)

##### 增量法求交点坐标

![](https://picture.lanlance.cn/i/2023/12/26/658aa94a4f868.png)

##### 扫描线的连贯性

如果没有新边加入，排序不变，无须调整

如果有新边 (第一次与扫描线相交的边) 加入，可用插入排序

##### 交点为顶点的配对

![](https://picture.lanlance.cn/i/2023/12/26/658ab8c02ba49.png)

顶点分三种：极小点，极大点，其它点。

![](https://picture.lanlance.cn/i/2023/12/26/658ab8e10f08e.png)

##### 避免填充扩大化

![](https://picture.lanlance.cn/i/2023/12/26/658ab97a9b19b.png)

#### 活性边表

活性边：对一条扫描线，和扫描线有交点的边。
活性边表：对一条扫描线，把所有活性边按 x 坐标递增的顺序构成一个链表。
链表结点 = data 域 + 指针域。

![](https://picture.lanlance.cn/i/2023/12/26/658abc63a2901.png)

#### 新边表

对每条扫描线建立表，用来存放与该扫描线第一次相交的边 (新边) 结点结构和活性边表相同。

![](https://picture.lanlance.cn/i/2023/12/26/658abdc210d68.png)

#### 区域填充

区域：连通的像素集合。

##### 区域表示

![](https://picture.lanlance.cn/i/2023/12/26/658abf134a80f.png)

##### 区域分类

![](https://picture.lanlance.cn/i/2023/12/26/658abf2cb930c.png)

#### 字符

包括字母、数字、汉字等。是特殊的图形，用于图形的注释说明等。

##### 字符编码

美国：

- 信息交换用标准代码集 (American Standard Code for Information Interchange)
- 127 个字符，8 位编码

中国：

- 汉字编码的国家标准字符集：GB 2312－80。
- 区位码：对 6763 个常用汉字，符号等编码，94 个区，94 个位，

用 94 * 94 矩阵表示。

##### 字符表示

###### 点阵型

每个字符用一个点阵表示，1 表示笔画经过，0 表示不经过

![](https://picture.lanlance.cn/i/2023/12/26/658abff293697.png)

缺点：

1. 字符有多种属性——数据量很大
2. 作变换 (比如旋转) 困难（需要操作每个像素）

压缩技术：

黑白段压缩、部件压缩、轮廓字形压缩

轮廓字形：

用直线、2/3 次 Bezier 曲线描述轮廓线，轮廓线构成区域的边界。用填充算法生成字符的点阵。优点：压缩比大，能保证字符质量。

###### 矢量型

不记录点阵，而是记录字符的笔画。

把字符表示成点的序列，相邻两点构成一个矢量，字符的形状由矢量序列表示。

优点：存储空间小，变换方便，只需对端点坐标作变换

![](https://picture.lanlance.cn/i/2023/12/26/658ac0fd0610c.png)

### 基本图形生成算法

#### 什么是生成

CG 是研究如何用计算机表示、生成、处理和显示图形的学科。

扫描转换：把图形数据转换成像素。

本质：给定图形，在屏幕上确定最佳逼近图形的像素。

#### 直线的表示方法

![](https://picture.lanlance.cn/i/2023/12/26/658ac1c3aa6ca.png)

#### 点和直线的位置关系

![](https://picture.lanlance.cn/i/2023/12/26/658ac220ec0b8.png)

##### 判别式 & 判别规则

![](https://picture.lanlance.cn/i/2023/12/26/658ac23988959.png)

#### 直线的扫描转换

数学：直线是理想 (绝对直) 的，由无数个点构成，没有宽度。

计算机：有限个点，有宽度

本质：用有限的像素逼近理想直线

##### 直接计算法

![](https://picture.lanlance.cn/i/2023/12/26/658ac2781786e.png)

##### DDA 算法

![](https://picture.lanlance.cn/i/2023/12/26/658ac33dbdf59.png)


优点：增量算法

缺点：k、y 是 float，需要作浮点乘法，对 y 作舍入，不利于硬件实现

![](https://picture.lanlance.cn/i/2023/12/26/658ac73ee9b2e.png)

##### 中点画线法

![](https://picture.lanlance.cn/i/2023/12/26/658ac88570194.png)

###### 判别式与判别规则

![](https://picture.lanlance.cn/i/2023/12/26/658ac8ac833fd.png)

###### 判别式改进 —— 用增量法计算 d

![](https://picture.lanlance.cn/i/2023/12/26/658ac99356f19.png)

![](https://picture.lanlance.cn/i/2023/12/26/658ac9ab517e7.png)

###### 判别式改进 —— 用 2d

![](https://picture.lanlance.cn/i/2023/12/26/658ac9d5ec8a6.png)

### 裁剪

裁剪：给定窗口，消除窗口以外的部分。

为什么要作裁剪：场景太大，需要显示的只是整个场景的一部分。

流程：先裁剪，再光栅化，避免无用的计算。

#### 裁剪分类

1. 裁剪窗口的维数

- 2D、3D

2. 裁剪窗口的形状

- 规则 (矩形、圆)
- 不规则 (多边形、多面体)

3. 裁剪对象

- 点、线、多边形、字符

#### 点裁剪

![](https://picture.lanlance.cn/i/2023/12/26/658accc01c742.png)

#### 线裁剪

##### Cohen-Sutherland 算法

![](https://picture.lanlance.cn/i/2023/12/26/658ace4ab037f.png)

![[Pasted image 20231226210109.png]]

![](https://picture.lanlance.cn/i/2023/12/26/658acea19d910.png)

![](https://picture.lanlance.cn/i/2023/12/26/658aceb9c8f6e.png)

![](https://picture.lanlance.cn/i/2023/12/26/658acfff8db4e.png)

优点

- 解决前两种很高效，避免了不必要的求交
- 适合大窗口和小窗口

缺点

- 求交涉及浮点运算
- 最坏的情况需要作四次裁剪

### 反走样

用离散量 (像素) 表示连续量 (图形) 引起的失真。

走样是数字化的必然产物。减少或消除走样称为反走样。

#### 常见的走样

- 锯齿形或阶梯形
- 小物体、细节在被放大、丢弃、失真
- 小物体在动画中时隐时现，产生跳跃或闪烁

#### 反走样技术

- 硬件：提高分辨率

增加分辨率，减轻锯齿效应，原来不能显示的细节可以显示。

4 倍帧缓存容量和 2 倍扫描时间——成本太高

- 算法

利用亮度过渡淡化锯齿效应。

#### 区域采样

![](https://picture.lanlance.cn/i/2023/12/26/658ad1dd693d8.png)

![](https://picture.lanlance.cn/i/2023/12/26/658ad1f2c0193.png)

### 消隐

消除不可见的点线面，称作消隐。

在 3D 中，人从某视点观察，不可能看到一个物体的全部表面，只能看到部分的点线面。若观察多个物体，物体之间还存在彼此遮挡。

![](https://picture.lanlance.cn/i/2023/12/26/658ad2773e5c6.png)

#### 消隐分类

1. 按消隐对象

- 线消隐：针对线框图，消除边
- 面消隐：针对表面图，消除面

2. 按算法所在空间分类 (Southerland)

- 物体空间 (object space)
- 图像空间 (image space)
- 二者结合

#### 影响因素

几乎所有算法都会涉及远近排序

物体离视点越远，越可能被遮挡
物体离视点越近，越可能被看见——近的遮挡远的

连贯性
a. 扫描线的连贯性
b. 物体的连贯性

#### 物体空间方法

![](https://picture.lanlance.cn/i/2023/12/26/658ad4c8d8e6d.png)

```c
for (每个物体)
{
把它与其它物体比较，确定可见的部分；
用适当的颜色绘制可见部分；
}
```

#### 图像空间方法

1. 在 2D 空间 (屏幕坐标系) 进行
2. 处理对象：投影后的像素
3. 复杂度：n 个对象，m 个像素，需做 m * n 次求交。

```c
for(屏幕上的每个像素)
{
比较深度，确定哪个多边形在该像素可见（离视点最近）；
绘制该像素；
}
```

相结合：先在物体空间删掉一些不可见的面，再在图像空间生成消隐图。

#### 面消隐

##### 画家算法

与油画家作画类似，由远及近，远景覆盖背景。

1. 把物体按远近（或深度）排序。
2. 按由远到近的顺序依次绘制各个面（后者覆盖前者）。

##### Z-buffer 算法（深度缓存算法）

图像空间方法

